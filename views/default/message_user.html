{{extend 'layout.html'}}
<head xmlns="http://www.w3.org/1999/html">
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
</head>

<html>
    <div id="logout" class="btn-group">
        <a id="searchTutor" class="btn btn-primary">Search For Tutors</a>
        <a id="prof" class="btn btn-primary">Profile</a>
        <a id="logoutbtn" class="btn btn-primary">Log Out</a>
    </div>

    <body>
        <script src="{{=URL('static', 'js/pubnub-3.7.18.min.js')}}"></script>
    </body>
    <div id="container">
        <div id="header">{{=tutor_name}}</div>
        <div id="messages" class="scrollable-messages">
        {{for i in range(len(messages.get("results"))):}}
            <div id="tutorName">{{=messages.get("results")[i].get("senderId")}}</div>
            <div id="message">{{=messages.get("results")[i].get("messageText")}}</div>
        {{pass}}
        </div>
    </div>

    <div id="input-area">
        <div id="send-message">
            <textarea id="message-input" class="form-control no-menu" maxlength="" aria-label="Message input"  spellcheck="true"></textarea>
            <a id="send-message-btn" class="btn btn-primary form-control">Send</a>
        </div>
    </div>
</html>

<script>
    $("#prof").click(function(e){
        document.location.href = "/WebUcscTutor/default/index";
    });

    $("#searchTutor").click(function(e){
        document.location.href = "/WebUcscTutor/default/name_list";
    });

    $("#logoutbtn").click(function(e){
        Parse.User.current().logOut();
        document.location.href = "/WebUcscTutor/default/index";
    });

    $("#send-message").click(function(e){
        publish();
    });

    // make it scroll to bottom of div on load
    $('#messages').scrollTop($('#messages')[0].scrollHeight - $('#messages')[0].clientHeight);

    function publish(){
        pubnub = PUBNUB({
            publish_key   : 'demo',
            subscribe_key : 'demo'
        });

        pubnub.publish({
            channel : "hello_world",
            message : "Hello from PubNub Docs!",
            callback: function(m){ console.log(m) }
        })
    }
</script>